(()=>{var t,e={1245:(t,e,n)=>{var a=n(4692);n(7081),n(9875),n(5194),n(97),n(7776),n(5219),n(9145),n(1453),a(document).ready((function(){let t;function e(){a.ajax({type:"GET",url:"/api/ai/get/current_data",contentType:"application/json"}).done((function(e){t=e,function(){if(t.cluster_status){a("#cluster-status").text(t.cluster_status.status||"N/A");const e=t.cluster_status.processed||0,n=t.cluster_status.total||0;a("#cluster-availability").text(`${e} / ${n}`)}else a("#cluster-status").text("N/A"),a("#cluster-availability").text(0);t.ai_status?(a("#ai-running-count").text(t.ai_status.running||0),a("#ai-queue-count").text(t.ai_status.queued||0)):(a("#ai-running-count").text(0),a("#ai-queue-count").text(0));const e=t.cluster_status.processed,n=t.cluster_status.total,o=t.cluster_status.status;a("#progress-status").text(`Status: ${o}`),a("#progress-bar").css("width",e/n*100+"%"),a("#progress-bar").attr("aria-valuenow",e),a("#progress-bar").text(`${e}/${n}`),null!==t.ai_status.response&&a("#ai-response").text(t.ai_status.response),null!==t.ai_status.query&&a("#ai-query").text(t.ai_status.query),function(t){const e=a("#cluster-table tbody"),n=a("#cluster-table");a.fn.dataTable.isDataTable(n)&&n.DataTable().clear().destroy(),e.empty(),Array.isArray(t)&&0!==t.length?(t.sort(((t,e)=>r(t).localeCompare(r(e)))),t.forEach((t=>{if(!Array.isArray(t))return void console.error("Invalid cluster structure:",t);t.sort(((t,e)=>t.localeCompare(e)));const n=`Cluster ${t[0]}`,a=function(t){return t.map((t=>`<span class="badge bg-info">\n                <a href="${base_url}?command=search&col=2&q=%5C%22${t}%5C%22" target="_blank" class="link-light">${t}</a>\n            </span>`)).join(" ")}(t),r=t.map((t=>`%5C%22${t}%5C%22`)).join("%3AOR%3A"),o=`<tr>\n                            <td>${n}</td>\n                            <td>${a} ${t.length>1?`<span class="badge bg-info">\n                    <a href="${base_url}?command=search&col=2&q=${r}" target="_blank" class="link-light">Show all</a>\n                </span>`:""}</td>\n                            <td>${t.length}</td>\n                        </tr>`;e.append(o)})),n.DataTable({paging:!0,stateSave:!0,pageLength:10,responsive:!0,lengthMenu:[[10,50,100,500,-1],[10,50,100,500,"All"]],dom:'rt<"container"<"row"<"col-md-6"li><"col-md-6"p>>>',columnDefs:[{targets:2,orderDataType:"dom-text"}],order:[[2,"desc"]]})):console.error("Invalid or empty data.")}(t.clusters),function(t){a.fn.dataTable.isDataTable("#ai-progress-table")&&a("#ai-progress-table").DataTable().clear().destroy();const e=a("#ai-progress-table tbody");e.empty(),t.forEach((t=>{const n=t.id||"N/A",a=t.prompt?t.prompt:"N/A",r=t.status||"N/A",o=t.ai_response?JSON.stringify(t.ai_response,null,2):"N/A",s=t.try_count||"X",i=Math.floor(Date.now()/1e3),c=t.time?Math.max(0,Math.ceil(9-(i-t.time))):"N/A",l=`\n                <tr id="row-${n}">\n                    <td>${n}</td>\n                    <td>${a}</td>\n                    <td>${r}</td>\n                    <td>${o}</td>\n                    <td>${s}</td>td>\n                    <td id="countdown-${n}">${"N/A"!==c?`${c} sec`:c}</td>\n                </tr>\n            `;e.append(l)})),a("#ai-progress-table").DataTable({paging:!0,stateSave:!0,pageLength:10,responsive:!0,lengthMenu:[[10,50,100,500,-1],[10,50,100,500,"All"]],dom:'rt<"container"<"row"<"col-md-6"li><"col-md-6"p>>>',order:[[0,"asc"]]})}(t.ai_formalization)}()}))}function n(e){if(t.sim_methods&&Array.isArray(t.sim_methods[1])){const n=a("#clustering-process-select");n.empty(),t.sim_methods[1].forEach((function(t){const r=a("<option></option>").attr("value",t.name).text(`${t.name}: ${t.description}`);t.name===e?(r.prop("selected",!0),function(t,e,n){const r=a("#similarity-slider"),o=Math.min(t,e),s=Math.max(t,e),i=(e-t)/200;r.attr("step",i),r.attr("min",o),r.attr("max",s),currentVal=Math.max(o,Math.min(n,s)),r.val(currentVal),a("#slider-value").text(currentVal)}(t.interval[0],t.interval[1],t.default)):r.prop("selected",!1),n.append(r)}))}}function r(t){return Array.isArray(t)&&0!==t.length?t.map((t=>t.toString())).sort()[0]:""}a(document).ready((function(){e(),function(){const e=setInterval((function(){t&&(clearInterval(e),n(function(){const e=t.sim_methods[1].find((function(t){return t.selected}));return e?e.name:null}()),function(e){if(t.ai_methods){const n=a("#prompt-parsing-selection");n.empty(),t.ai_methods.forEach((function(t){const r=a("<option></option>").attr("value",t.name).text(`${t.name}: ${t.description}`);t.name===e?r.prop("selected",!0):r.prop("selected",!1),n.append(r)}))}}(function(){const e=t.ai_methods.find((function(t){return t.selected}));return e?e.name:null}()),t.flags&&(a("#toggle-system-switch").prop("checked",t.flags.system).trigger("change"),a("#toggle-ai-switch").prop("checked",t.flags.ai).trigger("change")))}),30)}()})),setInterval(e,1e3),a("#terminate-all-button").click((function(){a.ajax({type:"POST",url:"/api/ai/terminate/all",contentType:"application/json"}).done((function(t){alert(t.message)})).fail((function(t){alert(`Error: ${t.responseText}`)}))})),a("#toggle-system-switch").on("change",(function(){const t=a(this).is(":checked");a.ajax({type:"POST",url:"/api/ai/set/flag/system",contentType:"application/json",data:JSON.stringify({system_enabled:t})})})),a("#toggle-ai-switch").on("change",(function(){const t=a(this).is(":checked");a.ajax({type:"POST",url:"/api/ai/set/flag/ai",contentType:"application/json",data:JSON.stringify({ai_enabled:t})})})),a("#clustering-process-select").on("change",(function(){const t=a(this).val();a.ajax({type:"POST",url:"/api/ai/set/sim/method",contentType:"application/json",data:JSON.stringify({name:t}),success:function(a){console.log(a.message),e(),n(t)},error:function(t){console.error("Error setting method:",t)}})})),a("#prompt-parsing-selection").on("change",(function(){const t=a(this).val();a.ajax({type:"POST",url:"/api/ai/set/ai/method",contentType:"application/json",data:JSON.stringify({name:t}),success:function(a){console.log(a.message),e(),n(t)},error:function(t){console.error("Error setting method:",t)}})})),a("#start-clustering").click((function(){a.ajax({type:"POST",url:"/api/ai/set/sim/start",contentType:"application/json"})})),a("#terminate-clustering-button").click((function(){a.ajax({type:"POST",url:"/api/ai/terminate/sim",contentType:"application/json"})})),a("#terminate-ai-button").click((function(){a.ajax({type:"POST",url:"/api/ai/terminate/ai",contentType:"application/json"})})),a("#process-ai").click((function(){a.ajax({type:"POST",url:"/api/ai/ai/process",contentType:"application/json"})})),a("#submit-prompt-button").click((function(){var t=a("#user-prompt").val();t?a.ajax({type:"POST",url:"/api/ai/ai/query",contentType:"application/json",data:JSON.stringify({query:t}),success:function(t){a("#ai-response").text("Processing your query...")},error:function(t,e,n){a("#ai-response").text("Error: "+t.responseJSON.error)}}):alert("Please enter a prompt!")})),a("#get-matrix-button").click((function(){a.ajax({type:"GET",url:"/api/ai/get/sim/matrix",contentType:"application/json"}).done((function(e){const n=document.getElementById("similarity-matrix"),a=n.querySelector("thead"),r=n.querySelector("tbody");a.innerHTML="",r.innerHTML="";const o=e.matrix,s=e.indexing,i=document.createElement("tr");i.appendChild(document.createElement("th")),Object.keys(s).forEach((t=>{const e=document.createElement("th");e.textContent=t,i.appendChild(e)})),a.appendChild(i),Object.keys(s).forEach(((e,n)=>{const a=document.createElement("tr"),s=document.createElement("th");s.textContent=e,a.appendChild(s),o[n].forEach((e=>{const n=document.createElement("td");n.textContent=e.toFixed(2),n.style.backgroundColor=function(e){const n=t.sim_methods[0],a=.3+.4*Math.abs(e-n);return e>=n?`rgba(0, 0, 180, ${Math.min(a,.7)})`:`rgba(0, 180, 0, ${Math.min(a,.7)})`}(e),a.appendChild(n)})),r.appendChild(a)}))})).fail((function(){const t=document.getElementById("similarity-matrix"),e=t.querySelector("thead"),n=t.querySelector("tbody");e.innerHTML="",n.innerHTML=""}))})),a("#similarity-slider").on("change",(function(){a("#slider-value").text(a(this).val()),a.ajax({type:"POST",url:"/api/ai/set/sim/threshold",contentType:"application/json",data:JSON.stringify({threshold:a(this).val()}),success:function(t){console.log(t.message)},error:function(t){console.error("Error setting threshold:",t)}})}))}))}},n={};function a(t){var r=n[t];if(void 0!==r)return r.exports;var o=n[t]={id:t,exports:{}};return e[t].call(o.exports,o,o.exports,a),o.exports}a.m=e,t=[],a.O=(e,n,r,o)=>{if(!n){var s=1/0;for(u=0;u<t.length;u++){for(var[n,r,o]=t[u],i=!0,c=0;c<n.length;c++)(!1&o||s>=o)&&Object.keys(a.O).every((t=>a.O[t](n[c])))?n.splice(c--,1):(i=!1,o<s&&(s=o));if(i){t.splice(u--,1);var l=r();void 0!==l&&(e=l)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[n,r,o]},a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.j=53,(()=>{var t={53:0};a.O.j=e=>0===t[e];var e=(e,n)=>{var r,o,[s,i,c]=n,l=0;if(s.some((e=>0!==t[e]))){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(c)var u=c(a)}for(e&&e(n);l<s.length;l++)o=s[l],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return a.O(u)},n=self.webpackChunkhanfor=self.webpackChunkhanfor||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),a.nc=void 0;var r=a.O(void 0,[223],(()=>a(1245)));r=a.O(r)})();