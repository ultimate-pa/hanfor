(()=>{var t,e={1245:(t,e,n)=>{var o=n(4692);n(7081),n(9875),n(5194),n(97),n(7776),n(5219),n(9145),n(1453);const{io:a}=n(8007);o(document).ready((function(){let t,e=a("/ai_data",{path:url_prefix+"/socket.io/"});e.on("connect",(()=>console.log("Connected to AI Data WebSocket"))),e.on("disconnect",(()=>console.log("Disconnected from AI Data WebSocket"))),e.on("ai_update",(e=>{console.log("AI Update received:",e),function(e){for(const o in e)e.hasOwnProperty(o)&&(t[o]=e[o],n[o]&&n[o](e[o]))}(e)}));const n={ai_formalization:function(){o.fn.dataTable.isDataTable("#ai-progress-table")&&o("#ai-progress-table").DataTable().clear().destroy();const e=o("#ai-progress-table tbody");e.empty(),t.ai_formalization.forEach((n=>{const o=n.id||"N/A",a=n.prompt?n.prompt:"N/A",i=n.status||"N/A",r=n.ai_response?JSON.stringify(n.ai_response,null,2):"N/A",s=n.try_count||"X",c=Math.floor(Date.now()/1e3);let l=n.time?Math.max(0,Math.ceil(t.ai_formalization_deletion_time-(c-n.time))):"N/A";const d=`\n                <tr id="row-${o}">\n                    <td>${o}</td>\n                    <td>${a}</td>\n                    <td>${i}</td>\n                    <td>${r}</td>\n                    <td>${s}</td>\n                    <td id="countdown-${o}">${"N/A"!==l?`${l} sec`:l}</td>\n                </tr>\n            `;e.append(d),"N/A"!==l&&function(t,e){let n=e;const o=document.getElementById(`countdown-${t}`),a=setInterval((()=>{o?n>0?(n--,o.innerText=`${n} sec`):(clearInterval(a),o.innerText="ðŸ—‘ Deleted",document.getElementById(`row-${t}`)?.remove()):clearInterval(a)}),1e3)}(o,l)})),o("#ai-progress-table").DataTable({paging:!0,stateSave:!0,pageLength:10,responsive:!0,lengthMenu:[[10,50,100,500,-1],[10,50,100,500,"All"]],dom:'rt<"container"<"row"<"col-md-6"li><"col-md-6"p>>>',order:[[0,"asc"]]})},ai_methods:function(){const e=o("#prompt-parsing-selection");e.empty(),t.ai_methods.forEach((t=>{const n=o("<option></option>").attr("value",t.name).text(`${t.name}: ${t.description}`).prop("selected",t.selected);e.append(n)}))},ai_models:function(){const e=o("#ai-model-selection");e.empty(),t.ai_models.forEach((t=>{const n=o("<option></option>").attr("value",t.name).text(`${t.name}: ${t.description}`).prop("selected",t.selected);e.append(n)}))},ai_statistic:function(){let e=t.ai_statistic;const n=o("#ai-statistics-container");n.empty(),e?.forEach((t=>{const e=t.model||"N/A",a=t.prompt_gen||"N/A",i=t.avg_try_count||0,r=`ai-statistics-table-${e.replace(/\W/g,"-")}-${a.replace(/\W/g,"-")}`,s=`section-${r}`,c=`\n                <div class="ai-statistics-section" style="margin-bottom: 15px;">\n                    <h6 \n                        id="toggle-${r}" \n                        style="cursor: pointer; padding: 10px; background-color: #f1f1f1; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 5px; font-weight: bold;">\n                        ${e} - ${a}\n                        <span id="${r}-icon" style="float: right; color: #007bff;">[+]</span>\n                    </h6>\n                    <div id="${r}-content" style="display: none; padding: 10px; border: 1px solid #ccc; border-top: none; border-radius: 0 0 5px 5px;">\n                        <p>Average Try Count: ${i}</p>\n                        <table class="display ai-statistics-table">\n                            <thead>\n                                <tr>\n                                    <th>Status</th>\n                                    <th>Total</th>\n                                    <th>Percentage</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${t.status_table.map((t=>`\n                                    <tr>\n                                        <td>${t.status}</td>\n                                        <td>${t.total}</td>\n                                        <td>${t.percentage}%</td>\n                                    </tr>\n                                `)).join("")}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            `;n.append(c);const l="open"===localStorage.getItem(s),d=document.getElementById(`${r}-content`),p=document.getElementById(`${r}-icon`);l?(d.style.display="block",p.textContent="[-]"):(d.style.display="none",p.textContent="[+]"),document.getElementById(`toggle-${r}`).addEventListener("click",(()=>function(t,e){const n=document.getElementById(`${e}-content`),o=document.getElementById(`${e}-icon`);"none"===n.style.display?(n.style.display="block",o.textContent="[-]",localStorage.setItem(t,"open")):(n.style.display="none",o.textContent="[+]",localStorage.setItem(t,"closed"))}(s,r))),o(`#${r}-content .ai-statistics-table`).DataTable({paging:!1,searching:!1,info:!1,responsive:!0,order:[[1,"desc"]]})}))},ai_status:function(){o("#ai-query").text(t.ai_status.query||"No query"),o("#ai-queue-count").text(t.ai_status.queued||0),o("#ai-response").text(t.ai_status.response||"No response"),o("#ai-running-count").text(t.ai_status.running||0)},cluster_status:function(){const e=t.cluster_status.processed||0,n=t.cluster_status.total||0,a=t.cluster_status.status||"N/A",i=e/(n||1)*100;o("#cluster-status-overview, #cluster-status-interface").text(a),o("#cluster-availability").text(`${e} / ${n||0}`),o("#progress-bar").css("width",`${i}%`).attr("aria-valuenow",e).text(`${e}/${n}`)},clusters:function(){const e=o("#cluster-table tbody"),n=o("#cluster-table");let a=t.clusters;function i(t){return Array.isArray(t)&&0!==t.length?t.map((t=>t.toString())).sort()[0]:""}o.fn.dataTable.isDataTable(n)&&n.DataTable().clear().destroy(),e.empty(),Array.isArray(a)&&0!==a.length?(a.sort(((t,e)=>i(t).localeCompare(i(e)))),a.forEach((t=>{if(!Array.isArray(t))return void console.error("Invalid cluster structure:",t);t.sort(((t,e)=>t.localeCompare(e)));const n=`Cluster ${t[0]}`,o=function(t){return t.map((t=>`<span class="badge bg-info">\n                    <a href="${base_url}?command=search&col=2&q=%5C%22${t}%5C%22" target="_blank" class="link-light">${t}</a>\n                </span>`)).join(" ")}(t),a=t.map((t=>`%5C%22${t}%5C%22`)).join("%3AOR%3A"),i=`<tr>\n                            <td>${n}</td>\n                            <td>${o} ${t.length>1?`<span class="badge bg-info">\n                        <a href="${base_url}?command=search&col=2&q=${a}" target="_blank" class="link-light">Show all</a>\n                    </span>`:""}</td>\n                            <td>${t.length}</td>\n                        </tr>`;e.append(i)})),n.DataTable({paging:!0,stateSave:!0,pageLength:10,responsive:!0,lengthMenu:[[10,50,100,500,-1],[10,50,100,500,"All"]],dom:'rt<"container"<"row"<"col-md-6"li><"col-md-6"p>>>',columnDefs:[{targets:2,orderDataType:"dom-text"}],order:[[2,"desc"]]})):console.error("Invalid or empty data.")},flags:function(){o("#toggle-system-switch").prop("checked",t.flags.system).trigger("change"),o("#toggle-ai-switch").prop("checked",t.flags.ai).trigger("change")},req_ids:function(){const e=o("#idDropdown");e.empty(),t.req_ids.forEach((t=>{const n=o("<option></option>").attr("value",t).text(t);e.append(n)}))},sim_methods:function(){const e=o("#clustering-process-select");e.empty();const[n,a]=t.sim_methods;a.forEach((t=>{const n=o("<option></option>").attr("value",t.name).text(`${t.name}: ${t.description}`).prop("selected",t.selected);e.append(n)}));const i=a.find((t=>t.selected));i&&function(t,e,n){const a=o("#similarity-slider");a.attr({min:t,max:e,step:(e-t)/200}),a.val(n),o("#slider-value").text(n)}(i.interval[0],i.interval[1],i.default)}};function i(t,e){o.ajax({type:"POST",url:t,contentType:"application/json"}).done((function(t){alert(e||t.message)})).fail((function(t){const e=t.responseText||"An unknown error occurred.";alert(`Error: ${e}`)}))}function r(e,n,a){t.flags[n]!==a?o.ajax({type:"POST",url:e,contentType:"application/json",data:JSON.stringify({[`${n}_enabled`]:a})}).done((function(){t.flags[n]=a,console.log(`Successfully updated ${n} to ${a}`)})).fail((function(t){const e=t.responseText||"An error occurred while updating the setting.";alert(`Error: ${e}`)})):console.log(`No change detected for ${n}. No request sent.`)}o.ajax({type:"Get",url:"/api/ai/get/data/initial",contentType:"application/json"}).done((function(e){t=e,console.debug(t)})),function(){const e=setInterval((function(){t&&(clearInterval(e),function(){for(const t in n)n.hasOwnProperty(t)&&n[t]()}())}),30)}(),o("#terminate-all-button").click((function(){i("/api/ai/terminate/all","All processes have been successfully terminated.")})),o("#terminate-clustering-button").click((function(){i("/api/ai/terminate/sim","Clustering process has been successfully terminated.")})),o("#terminate-ai-button").click((function(){i("/api/ai/terminate/ai","AI process has been successfully terminated.")})),o("#toggle-system-switch").on("change",(function(){r("/api/ai/set/flag/system","system",o(this).is(":checked"))})),o("#toggle-ai-switch").on("change",(function(){r("/api/ai/set/flag/ai","ai",o(this).is(":checked"))}));const s={"#clustering-process-select":"/api/ai/set/sim/method","#prompt-parsing-selection":"/api/ai/set/ai/method","#ai-model-selection":"/api/ai/set/ai/model"};function c(t,e=null,n=null,a=null){o.ajax({type:"POST",url:t,contentType:"application/json",data:e?JSON.stringify(e):null}).done((function(t){console.log(t.message),"function"==typeof n&&n(t)})).fail((function(t){const e=t.responseJSON?.error||t.responseText||"An unknown error occurred.";console.error("Error:",e),"function"==typeof a&&a(e)}))}function l(t,e,n){o.ajax({type:"GET",url:t,contentType:"application/json"}).done(e).fail(n)}function d(e){const n=document.getElementById("similarity-matrix"),o=n.querySelector("thead"),a=n.querySelector("tbody");o.innerHTML="",a.innerHTML="";const{matrix:i,indexing:r}=e,s=document.createElement("tr");s.appendChild(document.createElement("th")),Object.keys(r).forEach((t=>{const e=document.createElement("th");e.textContent=t,s.appendChild(e)})),o.appendChild(s),Object.keys(r).forEach(((e,n)=>{const o=document.createElement("tr"),r=document.createElement("th");r.textContent=e,o.appendChild(r),i[n].forEach((e=>{const n=document.createElement("td");n.textContent=e.toFixed(2),n.style.backgroundColor=function(e){const n=t.sim_methods[0],o=.3+.4*Math.abs(e-n);return e>=n?`rgba(0, 0, 180, ${Math.min(o,.7)})`:`rgba(0, 180, 0, ${Math.min(o,.7)})`}(e),o.appendChild(n)})),a.appendChild(o)}))}function p(){const t=document.getElementById("similarity-matrix");t.querySelector("thead").innerHTML="",t.querySelector("tbody").innerHTML="",alert("Failed to load similarity matrix.")}Object.keys(s).forEach((function(t){o(t).on("change",(function(){const e=o(this).val();!function(t,e){o.ajax({type:"POST",url:t,contentType:"application/json",data:JSON.stringify({name:e})}).done((function(t){console.log(t.message)})).fail((function(t){console.error("Error setting method/model:",t),alert("Failed to update selection. Please try again.")}))}(s[t],e)}))})),o("#start-clustering").click((function(){c("/api/ai/set/sim/start")})),o("#process-ai").click((function(){c("/api/ai/ai/process")})),o("#submit-prompt-button").click((function(){const t=o("#user-prompt").val();t?c("/api/ai/ai/query",{query:t},(()=>o("#ai-response").text("Processing your query...")),(t=>o("#ai-response").text(`Error: ${t}`))):alert("Please enter a prompt!")})),o("#submit-ids-button").click((function(){const t=o("#id-input").val().trim();t?c("/api/ai/set/ids",{ids:t},null,(t=>alert(t))):alert("Please enter at least one ID!")})),o("#similarity-slider").on("change",(function(){const t=o(this).val();o("#slider-value").text(t),c("/api/ai/set/sim/threshold",{threshold:t},(t=>console.log(t.message)),(t=>console.error("Error setting threshold:",t)))})),o("#get-matrix-button").click((function(){l("/api/ai/get/sim/matrix",d,p)})),o("#idSearch").on("input",(function(){!function(e=""){const n=document.getElementById("idDropdown");n.innerHTML="";const o=t.req_ids.filter((t=>t.toLowerCase().includes(e.toLowerCase())));if(o.forEach((t=>{const e=document.createElement("option");e.value=t,e.textContent=t,n.appendChild(e)})),0===o.length){const t=document.createElement("option");t.textContent="No matching IDs",t.disabled=!0,n.appendChild(t)}}(o(this).val())})),o("#idDropdown").on("change",(function(){const t=o(this).val();l(`/api/ai/set/log/id?id=${t}`,(e=>function(t,e){let n=`<h3>Log for ID: ${t}</h3>`;Object.entries(e).sort(((t,e)=>parseInt(t[0].split("_").pop())-parseInt(e[0].split("_").pop()))).forEach((([t,e])=>{n+=`\n                <div class="log-entry">\n                    <p><strong>Time:</strong> ${t}</p>\n            `,Object.entries(e).forEach((([t,e])=>{n+=`<p><strong>${t}:</strong> ${e}</p>`})),n+="</div><hr>"})),o("#log-container").html(n)}(t,e.data)),(()=>alert("Failed to fetch log data for the selected ID.")))}))}))}},n={};function o(t){var a=n[t];if(void 0!==a)return a.exports;var i=n[t]={id:t,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.exports}o.m=e,t=[],o.O=(e,n,a,i)=>{if(!n){var r=1/0;for(d=0;d<t.length;d++){for(var[n,a,i]=t[d],s=!0,c=0;c<n.length;c++)(!1&i||r>=i)&&Object.keys(o.O).every((t=>o.O[t](n[c])))?n.splice(c--,1):(s=!1,i<r&&(r=i));if(s){t.splice(d--,1);var l=a();void 0!==l&&(e=l)}}return e}i=i||0;for(var d=t.length;d>0&&t[d-1][2]>i;d--)t[d]=t[d-1];t[d]=[n,a,i]},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.j=53,(()=>{var t={53:0};o.O.j=e=>0===t[e];var e=(e,n)=>{var a,i,[r,s,c]=n,l=0;if(r.some((e=>0!==t[e]))){for(a in s)o.o(s,a)&&(o.m[a]=s[a]);if(c)var d=c(o)}for(e&&e(n);l<r.length;l++)i=r[l],o.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return o.O(d)},n=self.webpackChunkhanfor=self.webpackChunkhanfor||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),o.nc=void 0;var a=o.O(void 0,[223],(()=>o(1245)));a=o.O(a)})();